<Window x:Class="axion.Views.Windows.MainWindow"
        x:Name="MainWindowWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:windows="clr-namespace:axion.Views.Windows"
        xmlns:local="clr-namespace:axion.Views.Components"
        xmlns:converters="clr-namespace:axion.Converters"
        mc:Ignorable="d"
        Title="Axion" Height="450" Width="800"
        Loaded="MainWindow_OnLoaded"
        Background="{DynamicResource AppBackground0}"
        Foreground="{DynamicResource AppForeground0}">
    <Window.DataContext>
        <windows:MainWindowViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </Window.Resources>

    <Grid Background="{DynamicResource AppBackground1}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="200" />
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Menu Grid.ColumnSpan="3">
            <MenuItem Header="_File">
                <MenuItem
                    Header="Open Project"
                    Command="{Binding SetProject}"
                    CommandParameter="{Binding ElementName=MainWindowWindow}" />
                <Separator/>
                <MenuItem
                    Header="Exit"
                    Command="{Binding Exit}"
                    CommandParameter="{Binding ElementName=MainWindowWindow}" />
            </MenuItem>

            <MenuItem Header="_View">
                <MenuItem
                    Header="Light Mode"
                    Command="{Binding SetTheme}"
                    CommandParameter="pack://application:,,,/Themes/Light.xaml" />
                <MenuItem
                    Header="Dark Mode"
                    Command="{Binding SetTheme}"
                    CommandParameter="pack://application:,,,/Themes/Dark.xaml" />
            </MenuItem>
        </Menu>

        <!-- Left Panel -->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="Black" BorderThickness="1">
            <DockPanel LastChildFill="True">
                <!-- Folder name header -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="8" VerticalAlignment="Center">
                    <Button
                        Command="{Binding Back}"
                        Visibility="{Binding CanGoBack, Converter={StaticResource BoolToVisibility}}"
                        Content="&lt;"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="4 0"/>
                    <TextBlock
                        Text="{Binding LoadedDirectoryName}"
                        FontWeight="Bold" Margin="4 0 0 0" />
                </StackPanel>

                <!-- Buttons at bottom -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Bottom" Margin="4" HorizontalAlignment="Center">
                    <Button
                        Command="{Binding EntryNew}"
                        CommandParameter="{Binding ElementName=MainWindowWindow}"
                        Content="New" Margin="4,0" Width="50" />
                    <Button
                        Command="{Binding EntryRename}"
                        CommandParameter="{Binding ElementName=MainWindowWindow}"
                        Content="Rename" Margin="4,0" Width="50" />
                    <Button
                        Style="{StaticResource DangerButton}"
                        Command="{Binding EntryDelete}"
                        CommandParameter="{Binding ElementName=MainWindowWindow}"
                        Content="Delete" Margin="4,0" Width="50" />
                </StackPanel>

                <!-- List of selectable items -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ListBox
                        ItemsSource="{Binding Entries}"
                        SelectedItem="{Binding SelectedEntry}"
                        Margin="4">
                        <ListBox.Resources>
                            <Style TargetType="ListBoxItem">
                                <EventSetter Event="MouseDoubleClick" Handler="ListBoxItem_DoubleClick" />
                            </Style>

                            <!-- Directory item template -->
                            <DataTemplate DataType="{x:Type local:DirectoryViewModel}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📁" Margin="0,0,6,0" Foreground="{DynamicResource AppForeground1}" />
                                    <TextBlock Text="{Binding EntryName}" Foreground="{DynamicResource AppForeground1}" />
                                </StackPanel>
                            </DataTemplate>

                            <!-- Timer item template -->
                            <DataTemplate DataType="{x:Type local:TimerViewModel}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⏱" Margin="0,0,6,0" Foreground="{DynamicResource AppForeground1}" />
                                    <TextBlock Text="{Binding EntryName}" Foreground="{DynamicResource AppForeground1}" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.Resources>
                    </ListBox>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- Center Panel -->
        <Border Grid.Row="1" Grid.Column="1" BorderBrush="Black" BorderThickness="1">
            <Grid>
                <!-- State 1: None -->
                <StackPanel
                    Visibility="{Binding NoneVisibility}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">

                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Opacity" Value="0"/>

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding NoneVisibility}" Value="Visible">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="1" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>

                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="0" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock
                        Foreground="{DynamicResource AppForeground2}"
                        x:Name="NoSelectionMessage"
                        Text="Select something to show details"/>
                </StackPanel>

                <!-- State 2: Directory selected -->
                <StackPanel
                    Visibility="{Binding DirectoryVisibility}"
                    x:Name="DirectoryDetails"
                    Margin="12">

                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Opacity" Value="0"/>

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding DirectoryVisibility}" Value="Visible">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="1" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>

                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="0" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock
                        Text="{Binding SelectedEntry.EntryName, FallbackValue=''}"
                        FontSize="16" FontWeight="Bold" Margin="0 0 0 12">
                    </TextBlock>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Total time spent" Grid.Row="0" Grid.Column="0" />
                            <TextBlock
                                Text="{Binding SelectedEntry.EntryTimeElapsed, FallbackValue=''}"
                                Grid.Row="0" Grid.Column="1" Margin="12 0" />

                            <TextBlock Text="Number of items" Grid.Row="1" Grid.Column="0" />
                            <TextBlock
                                Text="{Binding SelectedDirectoryViewModel.Count, FallbackValue=''}"
                                Grid.Row="1" Grid.Column="1" Margin="12 0" />

                            <TextBlock Text="Average time" Grid.Row="2" Grid.Column="0" />
                            <TextBlock
                                Text="{Binding SelectedDirectoryViewModel.Average, FallbackValue=''}"
                                Grid.Row="2" Grid.Column="1" Margin="12 0" />

                            <TextBlock Text="Max time" Grid.Row="3" Grid.Column="0" />
                            <TextBlock
                                Text="{Binding SelectedDirectoryViewModel.Max, FallbackValue=''}"
                                Grid.Row="3" Grid.Column="1" Margin="12 0" />

                            <TextBlock Text="Min time" Grid.Row="4" Grid.Column="0" />
                            <TextBlock
                                Text="{Binding SelectedDirectoryViewModel.Min, FallbackValue=''}"
                                Grid.Row="4" Grid.Column="1" Margin="12 0" />
                        </Grid>
                    </ScrollViewer>
                </StackPanel>

                <!-- State 3: Timer selected -->
                <StackPanel
                    x:Name="TimerDetails"
                    Visibility="{Binding TimerVisibility}"
                    Margin="12">

                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Opacity" Value="0"/>

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TimerVisibility}" Value="Visible">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="1" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>

                                    <DataTrigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation To="0" Duration="0:0:0.2" Storyboard.TargetProperty="Opacity"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock
                        Text="{Binding SelectedEntry.EntryName, FallbackValue=''}"
                        FontSize="16" FontWeight="Bold" Margin="0 0 0 12">
                    </TextBlock>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="Total time spent" Grid.Row="0" Grid.Column="0" />
                        <TextBlock
                            Text="{Binding SelectedEntry.EntryTimeElapsed, FallbackValue=''}"
                            Grid.Row="0" Grid.Column="1" Margin="12 0" />
                    </Grid>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListView
                            ItemsSource="{Binding Sessions}"
                            Visibility="{Binding SelectedTimerViewModel,
                               Converter={StaticResource NullToVisibilityConverter}}">

                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem" BasedOn="{StaticResource ListItem}">
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                </Style>
                            </ListView.ItemContainerStyle>

                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Template}" />
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </ScrollViewer>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Right Panel -->
        <Border Grid.Row="1" Grid.Column="2" BorderBrush="Black" BorderThickness="1">
            <DockPanel LastChildFill="True">
                <!-- Header -->
                <TextBlock Text="Timers" FontWeight="Bold" Padding="8" DockPanel.Dock="Top" />

                <!-- Bottom controls -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Bottom" Margin="4" HorizontalAlignment="Center">
                    <Button
                        Command="{Binding TimerToggle}"
                        Content="▶/⏸" Width="50" Margin="4,0" />
                    <Button
                        Style="{StaticResource DangerButton}"
                        Command="{Binding TimerRemove}"
                        Content="■" Width="50" Margin="4,0" />
                </StackPanel>

                <!-- List of timers -->
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ListBox
                        ItemsSource="{Binding Timers}"
                        SelectedItem="{Binding SelectedTimer}"
                        Margin="4">
                        <ListBox.Resources>
                            <DataTemplate DataType="{x:Type local:TimerDisplayViewModel}">
                                <TextBlock Text="{Binding ElapsedTime}" Foreground="{DynamicResource AppForeground1}" />
                            </DataTemplate>
                        </ListBox.Resources>
                    </ListBox>
                </ScrollViewer>
            </DockPanel>
        </Border>
    </Grid>
</Window>